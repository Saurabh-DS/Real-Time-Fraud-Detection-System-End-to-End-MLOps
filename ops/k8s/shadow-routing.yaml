apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: fraud-model-route
  namespace: fraud-detection-prod
spec:
  hosts:
  - fraud-prediction.fintech.internal
  http:
  - route:
    - destination:
        host: fraud-model-v1
        subset: live
      weight: 100
    mirror:
      host: fraud-model-v2
      subset: shadow
    mirror_percent: 100
---
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: fraud-model-destinations
spec:
  host: fraud-prediction.fintech.internal
  subsets:
  - name: live
    labels:
      version: v1
  - name: shadow
    labels:
      version: v2
